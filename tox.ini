[testenv]
whitelist_externals =
    /usr/bin/git
    /usr/local/bin/git

[testenv:compile]
commands = python -m conib compile --reload
usedevelop = true
deps = psycopg2-binary

[testenv:html]
commands = python -m conib html docs/index.html
usedevelop = true
deps =
    jinja2
    pybel-tools

####################
# Deployment tools #
####################
[testenv:bumpversion]
commands = bumpversion {posargs}
passenv = HOME
skip_install = true
deps = bumpversion

[testenv:build]
skip_install = true
deps =
    wheel
    setuptools
commands =
    python setup.py -q sdist bdist_wheel

[testenv:release]
skip_install = true
deps =
    {[testenv:build]deps}
    twine >= 1.5.0
commands =
    {[testenv:build]commands}
    twine upload --skip-existing dist/*

[testenv:finish]
skip_install = true
passenv = HOME
deps =
    bumpversion
    {[testenv:compile]deps}
    {[testenv:html]deps}
    {[testenv:release]deps}
commands =
    bumpversion release
    {[testenv:compile]commands}
    {[testenv:html]commands}
    git commit --all -m "Rebuilt CONIB"
    git push
    {[testenv:release]commands}
    bumpversion patch
    git push
whitelist_externals =
    /usr/bin/git
